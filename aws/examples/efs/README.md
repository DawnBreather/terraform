# Work with AWS EFS via terraform

A terraform module for making EFS.

## Usage
--------

Import the module and retrieve with ```terraform get``` or ```terraform get --update```. Adding a module resource to your template, e.g. `main.tf`:

```
#
# MAINTAINER Vitaliy Natarov "vitaliy.natarov@yahoo.com"
#
terraform {
  required_version = "~> 0.12.12"
}

provider "aws" {
    region                  = "us-west-2"
    shared_credentials_file = pathexpand("~/.aws/credentials")
    profile                 = "default"
}

module "efs" {
    source                  = "../../modules/efs"
    name                    = "TEST"
    region                  = "us-west-2"
    environment             = "nonprod"

    enable_efs_file_system  = true
    efs_file_system_name    = ""
    encrypted               = false
    kms_key_id              = ""
    performance_mode        = "generalPurpose"

    lifecycle_policy        = [
        {
            transition_to_ia    = "AFTER_90_DAYS"
        },
    ]
    
    enable_efs_mount_target = true
    subnet_ids              = ["subnet-0e2b323b731655057", "subnet-0ffa47878036f1641", "subnet-096406cfdf907ee11"]
    security_groups         = ["sg-07b62c0d0ea37056d"]
}
```

Module Input Variables
----------------------
- `name` - Name to be used on all resources as prefix (`default     = "TEST-codedeploy"`)
- `region` - The region where to deploy this code (e.g. us-east-1). (`default     = "us-east-1"`)
- `environment` - Environment for service (`default     = "STAGE"`)
- `orchestration` - Type of orchestration (`default     = "Terraform"`)
- `createdby` - Created by (` default     = "Vitaliy Natarov"`)
- `tags` - A list of tag blocks. Each element should have keys named key, value, and propagate_at_launch. (`default     = {}`)
- `enable_efs_file_system` - Enable EFS usage (`default       = false`)
- `efs_file_system_name` - Set name for AWS EFS (`default       = ""`)
- `performance_mode` - The file system performance mode. Can be either 'generalPurpose' or 'maxIO' (Default: 'generalPurpose'). (`default     = "generalPurpose"`)
- `encrypted` - If true, the disk will be encrypted. (`default     = true`)
- `kms_key_id` - The ARN for the KMS encryption key. When specifying kms_key_id, encrypted needs to be set to true. (`default     = ""`)
- `creation_token` - (Optional) A unique name (a maximum of 64 characters are allowed) used as reference when creating the Elastic File System to ensure idempotent file system creation. By default generated by Terraform. See Elastic File System user guide for more information. (`default     = ""`)
- `provisioned_throughput_in_mibps` - (Optional) The throughput, measured in MiB/s, that you want to provision for the file system. Only applicable with throughput_mode set to provisioned. (`default       = null`)
- `throughput_mode` - (Optional) Throughput mode for the file system. Defaults to bursting. Valid values: bursting, provisioned. When using provisioned, also set provisioned_throughput_in_mibps. (`default       = null`)
- `lifecycle_policy` - (Optional) A file system lifecycle policy object (`default       = []`)
- `enable_efs_mount_target` - Enable efs_mount_target (`default       = false`)
- `subnet_ids` - The ID of the subnets to add the mount target in. (`default     = []`)
- `file_system_id` - (Required) The ID of the file system for which the mount target is intended. (`default       = ""`)
- `ip_address` - (Optional) The address (within the address range of the specified subnet) at which the file system may be mounted via the mount target. (`default       = null`)
- `security_groups` - description (`default       = []`)

Authors
=======

Created and maintained by [Vitaliy Natarov](https://github.com/SebastianUA)
(vitaliy.natarov@yahoo.com).

License
=======

Apache 2 Licensed. See LICENSE for full details.
